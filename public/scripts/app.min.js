(()=>{"use strict";const t=Vue.component("chart",{props:["dataLoaded","slideCarouselToDate"],data:function(){return{chartData:[],chartAdded:!1}},methods:{update:function(t){this.chartData=[],this.formatChartData(t);var e=this,a=Object,s=20,r=0,n=25,i=d3.time.format("%b-%d-%Y"),o=function(){var t=n+r,e=1024-t;return u=parseInt(d3.select("#progressChart").style("width")),Math.max(u-t,e)},u=o(),l=parseInt(d3.select("#progressChart").style("height"))-50,d=d3.time.scale().range([0,u]).domain(d3.extent(this.chartData[0].datapoints,function(t){return t.date})),c=d3.scale.linear().range([l,0]).domain([0,10]),h=d3.svg.axis().scale(d).orient("bottom").innerTickSize(-l-s).outerTickSize(0).tickPadding(10).tickFormat(d3.time.format("%b %d")),g=d3.svg.axis().scale(c).orient("left"),f=d3.svg.line().interpolate("cardinal").x(function(t){return d(t.date)}).y(function(t){return c(t.attribute)});if(this.chartAdded)(a=d3.select("#progressChart")).select(".o-axis--x").call(h),a.selectAll(".o-line").data(this.chartData).attr("d",function(t){return f(t.datapoints)});else{(a=d3.select("#progressChart").attr("width",u+n+r).attr("height",l).append("g").attr("transform","translate("+n+","+s+")")).append("g").attr("class","o-axis--x").attr("transform","translate(0,"+l+")").call(h),a.append("g").attr("class","o-axis--y").call(g),a.selectAll(".tick").each(function(t){0===t&&this.remove()});a.selectAll(".o-line").data(this.chartData).enter().append("path").attr("class",function(t){return"o-line o-line--"+t.attribute}).attr("d",function(t){return f(t.datapoints)});for(var p=a.append("g").attr("class","o-focusGroup").style("display","none"),m=0;m<this.chartData.length;m++)p.append("g").attr("class","o-focus o-focus--"+this.chartData[m].attribute).append("circle").attr("r",7),a.select(".o-focus--"+this.chartData[m].attribute).append("text").attr("width",14).attr("dy",".35em");a.append("rect").attr("class","o-overlay").attr("width","100%").attr("height",l+s).attr("transform","translate(0,"+-s+")").on("mouseover",function(){p.style("display","block")}).on("mouseout",function(){p.style("display","none")}).on("mousemove",function(){for(var t,s,r,n=e.chartData[0].datapoints,o=0,u=[],l=i(d.invert(d3.mouse(this)[0])),h=0;h<n.length;h++)i(n[h].date)===l&&(o=h);for(h=0;h<e.chartData.length;h++){t=e.chartData[h].datapoints[o],s=d(t.date),r=c(t.attribute);for(var g=a.selectAll(".o-focus--"+e.chartData[h].attribute),f=0;f<u.length;f++)t.attribute===u[f]&&(s+=14);g.attr("transform","translate("+s+","+r+")"),g.select("text").text(t.attribute),u.push(t.attribute)}}).on("click",function(){var t=d3.time.format("%Y-%m-%d");e.slideCarouselToDate(t(d.invert(d3.mouse(this)[0])))});var v=function(){var t=o();d.range([0,t]),a.select(".o-axis--x").attr("transform","translate(0,"+l+")").call(h),a.selectAll(".o-line").attr("d",function(t){return f(t.datapoints)}),h.ticks(e.ignoreAutoGeneratedTicks)};d3.select(window).on("resize",v),v(),setTimeout(function(){v()},100),this.chartAdded=!0}},ignoreAutoGeneratedTicks:function(t,e,a){var s=new Date(t),r=new Date(e),n=[];for(r.setUTCDate(r.getUTCDate()+1);s<r;)s.setUTCDate(s.getUTCDate()+4),n.push(new Date(s));return n},formatChartData:function(t){var e,a;for(e=0;e<t.length;e++){if(t[e].date=new Date(t[e].date),t[e].date=new Date(t[e].date.setDate(t[e].date.getDate()+1)),0===e)for(a in t[e])"date"!==a&&"notes"!==a&&"_id"!==a&&this.chartData.push({attribute:a,datapoints:[]});for(a in t[e])"date"!==a&&"notes"!==a&&"_id"!==a&&this.getAttributeArrByName(a).push({date:t[e].date,attribute:t[e][a]})}},getAttributeData:function(t,e){for(var a=[],s=0;s<e.length;s++)a.push({date:e[s].date,value:parseInt(e[s][t])});return a},getAttributeArrByName:function(t){for(var e=0;e<this.chartData.length;e++)if(this.chartData[e].attribute===t)return this.chartData[e].datapoints;return null}},mounted:function(){}}),e=Vue.component("record",{props:["item","update","pause","restart","addNew","index","isLoggedIn"],data:function(){return{canEdit:!1,requesting:!1,defaults:{date:Date,mobility:"5",activity:"5",appetite:"5",pain:"5",stress:"5",notes:""}}},methods:{onInputInteractStart:function(){this.pause()},onInputInteractEnd:function(){this.restart()},editHandler:function(t){t.preventDefault(),this.canEdit=!this.canEdit,this.canEdit&&this.addNew&&this.reset()},updateHandler:function(t){t.preventDefault();var e=this;e.requesting=!0;var a=new XMLHttpRequest;a.open("POST","/addRecord",!0),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.onload=function(){a.status>=200&&a.status<400?(e.requesting=!1,e.canEdit=!e.canEdit,e.addNew&&e.reset(),setTimeout(function(){e.update()},250)):(console.log(a.responseText),console.warn("vue-record.js, addRecord : error"))},a.send(JSON.stringify({date:this.item.date,mobility:this.item.mobility,activity:this.item.activity,appetite:this.item.appetite,pain:this.item.pain,stress:this.item.stress,notes:this.item.notes}))},getDisplayMonth:function(t){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(t.split("-")[1])-1]},getDisplayDate:function(t){return parseInt(t.split("-")[2])},getDisplayYear:function(t){return t.split("-")[0]},reset:function(){this.item.date=this.defaults.date,this.item.mobility=this.defaults.mobility,this.item.activity=this.defaults.activity,this.item.appetite=this.defaults.appetite,this.item.pain=this.defaults.pain,this.item.stress=this.defaults.stress,this.item.notes=this.defaults.notes},addLeadingZero:function(t){return 1===t.toString().length?"0"+t.toString():t},getTodaysFormattedDate:function(){var t=new Date;return t.getUTCFullYear()+"-"+this.addLeadingZero(t.getMonth()+1)+"-"+this.addLeadingZero(t.getDate())}},mounted:function(){this.defaults.date=this.getTodaysFormattedDate()}}),a=Vue.component("settingsmenu",{props:["setShowSettings","setLoggedInSettings","setMenuToggle","isLoggedIn"],data:function(){return{isLocalStorage:!1,lsName:"appLogin",animateShowSettings:!1,showSettings:!1,hideSettingsTimer:null,requesting:!1,formFields:{username:{value:"",showError:!1},password:{value:"",showError:!1}}}},methods:{loginHandler:function(t){t.preventDefault();var e=!0;for(var a in this.formFields)""===this.formFields[a].value?(this.formFields[a].showError=!0,e=!1):this.formFields[a].showError=!1;e&&this.loginRequest()},logoutHandler:function(t){t.preventDefault()},loginRequest:function(){var t=this;t.requesting=!0;var e=new XMLHttpRequest;e.open("POST","/login",!0),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.onload=function(){if(e.status>=200&&e.status<400){t.requesting=!1;var a=JSON.parse(e.responseText);console.log(a[0]),console.log(a[0].success),"success"===a[0].success?(t.setLoggedInSettings(!0),t.persistUserSession(),t.closeHandler()):(t.formFields.username.showError=!0,t.formFields.password.showError=!0)}else console.log(e.responseText),console.warn("vue-settingsmenu.js, login : error")},e.send(JSON.stringify({username:t.formFields.username.value,password:t.formFields.password.value}))},persistUserSession:function(){},closeHandler:function(){this.hide();var t=this;this.hideSettingsTimer=setTimeout(function(){t.setShowSettings(!1),clearTimeout(t.hideSettingsTimer)},250)},hide:function(){this.animateShowSettings=!1,this.setMenuToggle(!1)},localStorageCheck:function(){var t="ls";try{return window.localStorage.setItem(t,t),window.localStorage.removeItem(t),!0}catch(t){return!1}},setItemInObj:function(t){var e=JSON.stringify(t);ls.isLocalStorage&&window.localStorage.setItem(this.lsName,e)},getItemFromObj:function(){var t;return ls.isLocalStorage&&(t=window.localStorage.getItem(this.lsName)),JSON.parse(t)},deleteItem:function(){ls.isLocalStorage&&window.localStorage.removeItem(this.lsName)}},mounted:function(){clearTimeout(this.hideSettingsTimer),this.showSettings=!0,this.animateShowSettings=!0,this.isLocalStorage=this.localStorageCheck()}});var s=new Vue({el:"#app",components:{carousel:VueCarousel.Carousel,slide:VueCarousel.Slide,record:e,chart:t,settingsmenu:a},data:{isLoggedIn:!1,toggleMenuButton:!1,prevCalPageCt:Number,requesting:!1,carouselTransform:String,datapoints:[],dataLoaded:!1,showSettings:!1,focusDate:String,currentPage:0,newRecord:{date:Date,mobility:"5",activity:"5",appetite:"5",pain:"5",stress:"5",notes:""}},methods:{getData:function(){var t=this;t.requesting=!0;var e=new XMLHttpRequest;e.open("GET","/getRecords",!0),e.onload=function(){e.status>=200&&e.status<400?(t.requesting=!1,t.datapoints=JSON.parse(e.responseText).sort(t.sortByDate).reverse(),s.$refs.progressChart.update(JSON.parse(e.responseText).sort(t.sortByDate).reverse()),t.dataLoaded=!0,t.prevCalPageCt=s.$refs.carousel.currentPerPage):(console.log(e.responseText),console.warn("index.js, getRecords : error"))},e.send()},displaySettings:function(){if(this.showSettings){var t=this;s.$refs.settingsmenu.hide(),setTimeout(function(){t.setShowSettings(!1)},250)}else this.setMenuToggle(!0),this.setShowSettings(!0)},update:function(){this.getData()},pause:function(){var t=s.$refs.carousel;this.carouselTransform=t.$refs["VueCarousel-inner"].style.transform,t.$refs["VueCarousel-inner"].classList.add("u-disableAllTransforms"),t.$refs["VueCarousel-inner"].style.left=/\((.*?)\,/.exec(this.carouselTransform)[1]},restart:function(){var t=s.$refs.carousel;t.$refs["VueCarousel-inner"].classList.remove("u-disableAllTransforms"),t.$refs["VueCarousel-inner"].style.transition="transform 0s ease 0s",t.$refs["VueCarousel-inner"].style.transform=this.carouselTransform,t.$refs["VueCarousel-inner"].style.left="auto"},slideCarouselToDate:function(t){for(var e=0;e<this.datapoints.length;e++)if(t===this.datapoints[e].date){var a=Math.floor(e/s.$refs.carousel.currentPerPage);s.$refs.carousel.goToPage(a)}var r=0;this.currentPage!==a&&(r=600),this.setCarouselFocusDate(t,r),this.currentPage=a},setCarouselFocusDate:function(t,e){var a=this;e||(e=0),setTimeout(function(){a.focusDate=t},e)},sortByDate:function(t,e){return t.date<e.date?-1:t.date>e.date?1:0},addLeadingZero:function(t){return 1===t.toString().length?"0"+t.toString():t},getTodaysFormattedDate:function(){var t=new Date;return t.getUTCFullYear()+"-"+this.addLeadingZero(t.getMonth()+1)+"-"+this.addLeadingZero(t.getDate())},setShowSettings:function(t){this.showSettings=t},setLoggedInSettings:function(t){this.isLoggedIn=t},setMenuToggle:function(t){this.toggleMenuButton=t}},mounted:function(){var t=this;this.newRecord.date=this.getTodaysFormattedDate(),this.getData(),window.addEventListener("resize",function(){console.log(s.$refs.carousel.currentPerPage),0===t.prevCalPageCt&&s.$refs.carousel.currentPerPage>0&&s.$refs.carousel.goToPage(0),t.prevCalPageCt=s.$refs.carousel.currentPerPage})}})})();
//# sourceMappingURL=app.min.js.map